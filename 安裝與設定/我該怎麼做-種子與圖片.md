# 白話版：我該怎麼處理種子資料跟圖片？

---

## 本次執行結果（backend/uploads 與 Zeabur 對應）

- **1. 已檢查**：`backend/uploads/` 有圖檔。其中 `backend/uploads/services/` 底下有 **arm / leg / back / other** 四類，共數十張服務圖片（含 .meta.json），且 **portfolio** 也有檔案。
- **2. 已確認**：這些檔案**已在 Git 追蹤**（目前 HEAD 含 122 個 uploads 檔案），且 **client 遠端已為最新**（`git push client main` 顯示 Everything up-to-date），故客戶倉庫 **diaochuan8888/Tattoo** 已包含 `backend/uploads`。
- **3. Zeabur 對應方式**：後端啟動時（`main.ts`）在 **NODE_ENV=production** 下會從 repo 的 `uploads` 複製到執行目錄，並依檔名／metadata 把「服務名稱 ↔ 圖片路徑」寫回 DB。請在 Zeabur 後端 **Variables** 加上 **`NODE_ENV` = `production`**（若尚未設定），然後在 Zeabur 專案裡對後端服務做一次 **重新部署（Redeploy）**，讓最新程式與 uploads 再跑一遍，20 個服務圖就會對應顯示。
- **4. 若沒有圖檔**：當時就不需要從本機重做；本專案已有圖檔且已 push 到 client，只需依上一步在 Zeabur 設 NODE_ENV 並重新部署即可。

---

## 一、你「現在」已經做好的（Zeabur）

- 前端、後端、資料庫都部署好了。
- 已經跑過 **seed-data.sql**（有分店、管理員、6 位刺青師、基本服務）。
- 已經跑過 **seed-data-homepage.sql**（首頁刺青分類有 20 個服務、可以加入購物車）。
- 已經跑過 **seed-data-artist-photos.sql**（6 位刺青師都有預設頭像）。

若首頁服務點「加入購物車」時出現「此服務尚未設定規格」，請在 **Zeabur 後端服務** 的 **Execute Command** 執行（不需 psql）：  
`node scripts/run-seed-homepage-and-variants.js`  
（Zeabur 後端 Root 已是 backend，直接執行即可。）執行後 20 個服務都會有尺寸／顏色／部位／設計費可選。

所以 Zeabur 現在：**登入、刺青師頭像、刺青分類** 都已經有了；跑完規格種子後**加入購物車**也能選規格，重新整理網頁看就好。

---

## 二、之後「新開一個環境」要怎麼做？

例如又幫另一個客戶在 Zeabur 開一個新專案，從頭來一次的時候：

1. **建立好** PostgreSQL、後端、前端，設好環境變數和網址。
2. **先建表**：本機執行  
   `prisma db push`（或讓後端自己跑 migrate）。
3. **再灌基礎資料**（分店、管理員、6 位刺青師、3 個基本服務、**含刺青師頭像**）：  
   本機執行  
   `psql "貼上那個環境的連線字串" -f backend/prisma/seed-data.sql`
4. **想讓首頁刺青分類有 20 個服務**：再執行  
   `psql "同一串連線字串" -f backend/prisma/seed-data-homepage.sql`
5. **讓這 20 個服務都有「規格」（尺寸、顏色、部位、設計費）**，顧客才能選規格、加入購物車：再執行  
   `psql "同一串連線字串" -f backend/prisma/seed-data-service-variants.sql`
6. 完成。不用再跑 seed-data-artist-photos.sql（因為現在的 seed-data.sql 已經有頭像了）。

---

## 三、圖片的白話說明

- **資料庫裡只存「圖片的網址或路徑」**，不存檔案本身。
- **刺青師頭像**：現在 seed 裡已經有寫好「預設頭像網址」，所以一灌完 seed 就會有圖；之後要換成真人照，去**後台 → 刺青師管理 → 編輯該刺青師 → 上傳照片**即可。
- **服務／刺青分類的圖**（半胛圖、排胛圖那些）：要嘛在**後台 → 服務管理**裡一個一個上傳，要嘛就繼續用現在前端的預設佔位圖，沒強制一定要馬上處理。

---

## 補充：之前是怎麼把 20 個服務的圖檔從本地上傳到 Railway 的？

當時的流程是這樣（不是透過後台一筆一筆上傳，而是**本機腳本 + 放進 Git**）：

1. **把 20 張圖放在專案根目錄的 `JPG` 資料夾裡**  
   檔名要對應服務名稱，例如：`半胛圖.png`、`排胛圖.png`、`大腿表面.jpg`、`小腿全包.jpg` 等（和 `seed-data-homepage.sql` 裡那 20 個服務名稱一致）。

2. **先讓 Railway 的資料庫裡有這 20 筆服務**  
   例如在 Railway 或本機用 `psql` 跑過 `seed-data-homepage.sql`。

3. **在本機執行上傳腳本**（會把圖複製到 `backend/uploads/services/` 並更新「當時連線的那個資料庫」的 `imageUrl`）  
   ```bash
   cd backend
   export DATABASE_URL="Railway 的 PostgreSQL 連線字串"   # 讓腳本直接改 Railway 的 DB
   node upload-service-images.js
   ```
   腳本會從 `JPG/` 讀圖，依檔名對應服務名稱，複製到 `backend/uploads/services/arm|leg|back|other/`，並把每個服務的 `imageUrl` 寫進資料庫。

4. **把 `backend/uploads/` 一起 commit 並 push 到 GitHub**  
   這樣部署到 Railway 時，程式碼裡就帶著這批圖檔。

5. **Railway 後端啟動時**（`main.ts`）會偵測到專案裡有 `uploads` 資料夾，在生產環境下會把 **git 裡的 `uploads` 複製到容器內實際提供圖片的目錄**，並依檔名／metadata 把「服務名稱 ↔ 圖片路徑」對齊寫回資料庫，所以 20 個服務的圖就會在 Railway 上顯示出來。

所以：**圖檔是跟著 Git 進 Railway 的**，不是只靠後台上傳。若要在 Zeabur 也有一份「自己的圖」（不依賴 Railway 網址），做法可以是：用同一批 `backend/uploads/` 放進客戶的 repo，並在 Zeabur 後端啟動時做和 Railway 一樣的「從 git 的 uploads 複製到執行目錄 + 更新 DB」；目前 Zeabur 若已沿用同一套後端程式，理論上也會有這段複製邏輯，只要 repo 裡有 `backend/uploads/` 且部署有包含到即可。

---

## 四、如果客戶要 Zeabur 的圖和 Railway「一模一樣」

Railway 上已經傳好刺青師照片、服務圖、作品集圖，希望 Zeabur 畫面顯示同一批圖時：

- **不用搬檔案**，只要在本機執行一支腳本，把 Zeabur 資料庫裡的圖片網址改成「指向 Railway」，前台就會從 Railway 載入同一張圖。
- 做法與步驟寫在：**[讓Zeabur圖片和Railway一模一樣.md](./讓Zeabur圖片和Railway一模一樣.md)**（需準備 Railway / Zeabur 的 DB 連線字串與 Railway 後端網址，執行 `backend/scripts/sync-image-urls-from-railway.js`）。

---

## 五、一句話總結

- **現在這個 Zeabur**：你已經處理完了，重新整理網頁確認就好。
- **以後新環境**：照「二」的順序，先 `seed-data.sql`，再視需要 `seed-data-homepage.sql`，再跑 `seed-data-service-variants.sql` 讓服務有規格可選。
- **要換成真人頭像或服務圖**：都到後台該功能（刺青師管理／服務管理）裡上傳替換即可。
- **要跟 Railway 圖一模一樣**：照「四」的說明，執行同步腳本即可。
