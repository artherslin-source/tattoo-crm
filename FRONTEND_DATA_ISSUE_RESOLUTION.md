# ðŸ”§ å‰ç«¯ç®¡ç†å¾Œå°æ•¸æ“šå•é¡Œè§£æ±ºæ–¹æ¡ˆ

**æ—¥æœŸï¼š** 2025-01-16  
**å•é¡Œï¼š** å‰ç«¯ç®¡ç†å¾Œå°è®€å–ä¸åˆ°ã€Œæœå‹™é …ç›®ã€ã€ã€Œåˆºé’å¸«ã€ã€ã€Œé ç´„ã€ã€ã€Œè¨‚å–®ã€  
**ç‹€æ…‹ï¼š** âœ… å¾Œç«¯å·²ä¿®å¾©ï¼Œå‰ç«¯éœ€è¦æ¸¬è©¦

---

## ðŸ“Š ç•¶å‰ç‹€æ…‹

### **å¾Œç«¯æœå‹™ âœ…**

| API ç«¯é»ž | ç‹€æ…‹ | æ•¸æ“šé‡ |
|----------|------|--------|
| **æœå‹™é …ç›®** `GET /services` | âœ… æ­£å¸¸ | 19 å€‹ |
| **åˆºé’å¸«** `GET /artists` | âœ… æ­£å¸¸ | 3 å€‹ |
| **é ç´„** `GET /admin/appointments` | âœ… æ­£å¸¸ | 24 å€‹ |
| **è¨‚å–®** `GET /admin/orders` | âœ… æ­£å¸¸ | 15 å€‹ |
| **æœƒå“¡** `GET /admin/members` | âœ… æ­£å¸¸ | 12 å€‹ |

### **ç’°å¢ƒé…ç½® âœ…**

| æœå‹™ | ç‹€æ…‹ | ä½ç½® |
|------|------|------|
| **PostgreSQL (Docker)** | âœ… å¥åº·é‹è¡Œ | localhost:5432 |
| **å¾Œç«¯ API** | âœ… é‹è¡Œä¸­ | http://localhost:4000 |
| **å‰ç«¯** | âœ… é‹è¡Œä¸­ | http://localhost:4001 |

### **è³‡æ–™åº«ä¸€è‡´æ€§ âœ…**

| ç’°å¢ƒ | é¡žåž‹ | ç‹€æ…‹ |
|------|------|------|
| **æœ¬åœ°ç«¯** | PostgreSQL 15 | âœ… é‹è¡Œä¸­ |
| **Railway** | PostgreSQL | âœ… é‹è¡Œä¸­ |
| **ä¸€è‡´æ€§** | å®Œå…¨ä¸€è‡´ | âœ… ç¢ºèª |

---

## ðŸ” å•é¡Œè¨ºæ–·

### **å·²ç¢ºèªçš„äº‹å¯¦ï¼š**

1. âœ… **å¾Œç«¯ API å®Œå…¨æ­£å¸¸**
   ```bash
   # æ¸¬è©¦çµæžœ
   æœå‹™é …ç›® API: âœ… 19 å€‹
   åˆºé’å¸« API: âœ… 3 å€‹
   é ç´„ API: âœ… 24 å€‹
   è¨‚å–® API: âœ… 15 å€‹ï¼ˆåˆ†é æ ¼å¼ï¼‰
   ```

2. âœ… **è³‡æ–™åº«æœ‰å®Œæ•´æ•¸æ“š**
   ```
   - 2 å€‹åˆ†åº—ï¼ˆä¸‰é‡åº—ã€æ±æ¸¯åº—ï¼‰
   - 3 å€‹åˆºé’å¸«
   - 12 å€‹æœƒå“¡ï¼ˆæœ‰å„²å€¼é¤˜é¡ï¼‰
   - 19 å€‹æœå‹™é …ç›®
   - 24 å€‹é ç´„
   - 15 å€‹è¨‚å–®ï¼ˆåŒ…å«åˆ†æœŸï¼‰
   ```

3. âœ… **ç™»å…¥åŠŸèƒ½æ­£å¸¸**
   ```bash
   # JWT token æˆåŠŸç”Ÿæˆ
   admin@test.com / 12345678 â†’ âœ… æˆåŠŸ
   ```

### **å¯èƒ½çš„å•é¡Œï¼š**

1. **å‰ç«¯ API é€£æŽ¥å•é¡Œ**
   - å‰ç«¯å¯èƒ½é€£æŽ¥åˆ°éŒ¯èª¤çš„å¾Œç«¯ URL
   - CORS å•é¡Œ
   - API è«‹æ±‚éŒ¯èª¤è™•ç†

2. **å‰ç«¯ç·©å­˜å•é¡Œ**
   - ç€è¦½å™¨ç·©å­˜èˆŠæ•¸æ“š
   - Next.js ç·©å­˜

3. **å‰ç«¯ä»£ç¢¼å•é¡Œ**
   - æ•¸æ“šæ ¼å¼è§£æžéŒ¯èª¤
   - ç‹€æ…‹ç®¡ç†å•é¡Œ

---

## ðŸ”§ è§£æ±ºæ­¥é©Ÿ

### **æ­¥é©Ÿ 1ï¼šç¢ºèªå‰ç«¯é€£æŽ¥åˆ°æ­£ç¢ºçš„å¾Œç«¯**

**æª¢æŸ¥å‰ç«¯ API é…ç½®ï¼š**
```typescript
// frontend/src/lib/api.ts
function detectApiBase(): string {
  // é–‹ç™¼ç’°å¢ƒ
  return "http://localhost:4000";  // âœ… æ­£ç¢º
}
```

**æ¸¬è©¦ï¼š**
1. æ‰“é–‹ç€è¦½å™¨
2. è¨ªå• `http://localhost:4001`
3. æ‰“é–‹é–‹ç™¼è€…å·¥å…·ï¼ˆF12ï¼‰
4. åˆ‡æ›åˆ° **Network** æ¨™ç±¤
5. é‡æ–°è¼‰å…¥é é¢
6. æª¢æŸ¥ API è«‹æ±‚ï¼š
   - æ‡‰è©²çœ‹åˆ° `http://localhost:4000/services`
   - æ‡‰è©²çœ‹åˆ° `http://localhost:4000/artists`
   - ç­‰ç­‰

---

### **æ­¥é©Ÿ 2ï¼šæ¸…é™¤ç€è¦½å™¨ç·©å­˜**

**ç¡¬åˆ·æ–°ï¼š**
- Mac: `Cmd + Shift + R`
- Windows: `Ctrl + Shift + R`

**æˆ–å®Œå…¨æ¸…é™¤ç·©å­˜ï¼š**
1. é–‹ç™¼è€…å·¥å…·ï¼ˆF12ï¼‰
2. å³éµé»žæ“Šåˆ·æ–°æŒ‰éˆ•
3. é¸æ“‡ã€Œæ¸…ç©ºå¿«å–ä¸¦å¼·åˆ¶é‡æ–°è¼‰å…¥ã€

---

### **æ­¥é©Ÿ 3ï¼šæª¢æŸ¥æŽ§åˆ¶å°éŒ¯èª¤**

**æ‰“é–‹ç€è¦½å™¨æŽ§åˆ¶å°ï¼š**
1. F12 æˆ– Cmd+Option+I
2. åˆ‡æ›åˆ° **Console** æ¨™ç±¤
3. æŸ¥çœ‹æ˜¯å¦æœ‰ç´…è‰²éŒ¯èª¤è¨Šæ¯ï¼š
   - CORS éŒ¯èª¤
   - 401 Unauthorized
   - 404 Not Found
   - Network Error

**å¦‚æžœçœ‹åˆ° CORS éŒ¯èª¤ï¼š**
```
Access to fetch at 'http://localhost:4000/services' 
from origin 'http://localhost:4001' has been blocked by CORS policy
```

**è§£æ±ºï¼š**
å¾Œç«¯çš„ CORS é…ç½®åœ¨ `.env` ä¸­ï¼š
```env
CORS_ORIGIN="http://localhost:3000"  # âŒ éŒ¯èª¤
```

æ‡‰è©²æ”¹ç‚ºï¼š
```env
CORS_ORIGIN="http://localhost:4001"  # âœ… æ­£ç¢º
```

---

### **æ­¥é©Ÿ 4ï¼šæª¢æŸ¥ Network è«‹æ±‚**

**åœ¨é–‹ç™¼è€…å·¥å…·çš„ Network æ¨™ç±¤ï¼š**

1. **æŸ¥çœ‹è«‹æ±‚ URL**
   - æ‡‰è©²æ˜¯ `http://localhost:4000/...`
   - å¦‚æžœæ˜¯å…¶ä»– URLï¼Œè¡¨ç¤ºå‰ç«¯é…ç½®éŒ¯èª¤

2. **æŸ¥çœ‹éŸ¿æ‡‰ç‹€æ…‹**
   - âœ… 200 OK - æˆåŠŸ
   - âŒ 401 Unauthorized - token å•é¡Œ
   - âŒ 404 Not Found - è·¯ç”±å•é¡Œ
   - âŒ 500 Internal Server Error - å¾Œç«¯éŒ¯èª¤
   - âŒ Failed - é€£æŽ¥å•é¡Œ

3. **æŸ¥çœ‹éŸ¿æ‡‰æ•¸æ“š**
   - é»žæ“Šè«‹æ±‚
   - æŸ¥çœ‹ **Response** æ¨™ç±¤
   - ç¢ºèªæ•¸æ“šæ ¼å¼æ­£ç¢º

---

## ðŸš¨ æœ€å¯èƒ½çš„å•é¡Œï¼šCORS

**ç—‡ç‹€ï¼š**
- å¾Œç«¯ API æ¸¬è©¦æ­£å¸¸ï¼ˆcurl å¯ä»¥è¨ªå•ï¼‰
- å‰ç«¯ç„¡æ³•ç²å–æ•¸æ“š
- æŽ§åˆ¶å°é¡¯ç¤º CORS éŒ¯èª¤

**åŽŸå› ï¼š**
```env
# backend/.env
CORS_ORIGIN="http://localhost:3000"  # âŒ ä½†å‰ç«¯åœ¨ 4001
```

**è§£æ±ºæ–¹æ¡ˆï¼š**

è®“æˆ‘ç«‹å³ä¿®å¾©é€™å€‹å•é¡Œï¼š

```bash
cd backend
cat > .env << 'EOF'
DATABASE_URL="postgresql://tattoo_user:tattoo_password@localhost:5432/tattoo_crm_dev?schema=public"
JWT_ACCESS_SECRET="your-access-secret-key-change-in-production"
JWT_REFRESH_SECRET="your-refresh-secret-key-change-in-production"
NODE_ENV="development"
PORT=4000
CORS_ORIGIN="http://localhost:4001"
PROTECT_REAL_DATA=false
EOF
```

ç„¶å¾Œé‡å•Ÿå¾Œç«¯ã€‚

---

## ðŸ“‹ å®Œæ•´çš„è¨ºæ–·æ¸…å–®

### **è«‹åœ¨ç€è¦½å™¨ä¸­æª¢æŸ¥ï¼š**

1. **æ‰“é–‹ http://localhost:4001**
2. **ç™»å…¥** `admin@test.com` / `12345678`
3. **æ‰“é–‹é–‹ç™¼è€…å·¥å…·** (F12)
4. **åˆ‡æ›åˆ° Console æ¨™ç±¤**
5. **æŸ¥çœ‹æ˜¯å¦æœ‰ç´…è‰²éŒ¯èª¤**

**è«‹å‘Šè¨´æˆ‘ï¼š**
- [ ] çœ‹åˆ° CORS éŒ¯èª¤ï¼Ÿ
- [ ] çœ‹åˆ° 401 Unauthorizedï¼Ÿ
- [ ] çœ‹åˆ° 404 Not Foundï¼Ÿ
- [ ] çœ‹åˆ° Network Errorï¼Ÿ
- [ ] å…¶ä»–éŒ¯èª¤ï¼Ÿ

---

## ðŸŽ¯ å¿«é€Ÿä¿®å¾©è…³æœ¬

å¦‚æžœç¢ºå®šæ˜¯ CORS å•é¡Œï¼ŒåŸ·è¡Œï¼š

```bash
cd /Users/jerrylin/tattoo-crm/backend

# æ›´æ–° CORS_ORIGIN ç‚ºå‰ç«¯ç«¯å£
cat > .env << 'EOF'
DATABASE_URL="postgresql://tattoo_user:tattoo_password@localhost:5432/tattoo_crm_dev?schema=public"
JWT_ACCESS_SECRET="your-access-secret-key-change-in-production"
JWT_REFRESH_SECRET="your-refresh-secret-key-change-in-production"
NODE_ENV="development"
PORT=4000
CORS_ORIGIN="http://localhost:4001"
PROTECT_REAL_DATA=false
EOF

# é‡å•Ÿå¾Œç«¯ï¼ˆwatch æ¨¡å¼æœƒè‡ªå‹•é‡è¼‰ï¼‰
# æˆ–æ‰‹å‹•é‡å•Ÿ
pkill -f "nest start"
npm run start:dev &
```

---

## ðŸ“Š ç¸½çµ

### **å·²ç¢ºèªæ­£å¸¸ï¼š**
- âœ… PostgreSQL é‹è¡Œä¸­
- âœ… å¾Œç«¯ API é‹è¡Œä¸­
- âœ… è³‡æ–™åº«æœ‰å®Œæ•´æ•¸æ“š
- âœ… API å¯ä»¥æ­£å¸¸è¨ªå•ï¼ˆcurl æ¸¬è©¦é€šéŽï¼‰
- âœ… å‰ç«¯æœå‹™é‹è¡Œä¸­
- âœ… ç’°å¢ƒä¸€è‡´æ€§ï¼ˆæœ¬åœ°å’Œ Railway éƒ½æ˜¯ PostgreSQLï¼‰

### **å¾…ç¢ºèªï¼š**
- â³ å‰ç«¯æ˜¯å¦èƒ½æˆåŠŸé€£æŽ¥å¾Œç«¯
- â³ æ˜¯å¦æœ‰ CORS éŒ¯èª¤
- â³ å‰ç«¯æ•¸æ“šæ˜¯å¦æ­£å¸¸é¡¯ç¤º

### **ä¸‹ä¸€æ­¥ï¼š**
è«‹æ‰“é–‹ç€è¦½å™¨ä¸¦æª¢æŸ¥æŽ§åˆ¶å°éŒ¯èª¤ï¼Œç„¶å¾Œå‘Šè¨´æˆ‘å…·é«”çš„éŒ¯èª¤è¨Šæ¯ï¼

---

**ç•¶å‰ç’°å¢ƒï¼š**
- å‰ç«¯ï¼šhttp://localhost:4001 âœ…
- å¾Œç«¯ï¼šhttp://localhost:4000 âœ…
- è³‡æ–™åº«ï¼šPostgreSQL (Docker) âœ…
- æ•¸æ“šï¼šå®Œæ•´ âœ…

**å¯èƒ½éœ€è¦ä¿®å¾©ï¼š** CORS é…ç½®ï¼ˆå¦‚æžœå‰ç«¯åœ¨ 4001 ç«¯å£ï¼‰

