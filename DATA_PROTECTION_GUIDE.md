# 資料保護機制指南

## 🛡️ 服務項目資料保護

為了保護客戶的服務項目資料不被意外重建，我們實現了資料保護機制。

### 保護模式控制

通過環境變數 `PROTECT_REAL_DATA` 來控制資料保護：

```bash
# 保護模式（推薦用於生產環境）
PROTECT_REAL_DATA=true

# 完整重建模式（僅用於開發測試）
PROTECT_REAL_DATA=false
```

### 保護的資料類型

當 `PROTECT_REAL_DATA=true` 時，以下資料將被保護：

1. **服務項目 (Services)**
   - 服務名稱、價格、時長
   - 服務分類和描述
   - 服務圖片URL
   - 服務狀態

2. **分店資料 (Branches)**
   - 分店名稱和地址
   - 分店聯絡資訊

3. **刺青師資料 (Artists)**
   - 刺青師基本資訊
   - 刺青師作品集

### 使用方式

#### 生產環境（保護客戶資料）
```bash
# 設置環境變數
export PROTECT_REAL_DATA=true

# 執行資料重建（只重建測試資料，保留客戶資料）
npm run db:seed
```

#### 開發環境（完整重建）
```bash
# 設置環境變數
export PROTECT_REAL_DATA=false

# 執行資料重建（重建所有資料）
npm run db:seed
```

### 資料修改方式

#### 服務項目修改
- ✅ **通過前端管理界面** → 推薦方式
- ✅ **通過API直接修改** → 開發人員使用
- ❌ **通過seed腳本重建** → 保護模式下被阻止

#### 其他資料修改
- 預約記錄、訂單記錄等測試資料仍會正常重建
- 會員資料會正常重建（測試用）

### 注意事項

1. **Railway部署環境**
   - 在Railway控制台設置 `PROTECT_REAL_DATA=true`
   - 確保客戶資料不會被意外重建

2. **本地開發**
   - 開發時可設置 `PROTECT_REAL_DATA=false`
   - 測試完成後記得改回 `true`

3. **資料備份**
   - 建議定期備份客戶資料
   - 重要修改前先備份

### 檢查保護狀態

執行seed腳本時會顯示保護狀態：

```
🛡️ 保護模式：將保留現有的分店和刺青師數據
🛡️ 保護模式：保留服務項目數據
🛡️ 保護模式：使用現有 19 個服務項目
```

或

```
⚠️ 完整重建模式：將重建所有數據（包括分店和刺青師）
✅ 建立 19 個服務
```

### 緊急情況

如果需要強制重建所有資料：

1. 設置 `PROTECT_REAL_DATA=false`
2. 執行 `npm run db:seed`
3. 重新設置 `PROTECT_REAL_DATA=true`

**⚠️ 警告：這將刪除所有客戶資料！**
