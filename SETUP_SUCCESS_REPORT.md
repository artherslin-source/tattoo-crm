# âœ… æœ¬åœ° PostgreSQL é–‹ç™¼ç’°å¢ƒè¨­ç½®æˆåŠŸå ±å‘Š

**æ—¥æœŸ**: 2025-10-15  
**ç‹€æ…‹**: âœ… å®Œå…¨æˆåŠŸ  
**ç¸½è€—æ™‚**: ç´„ 10 åˆ†é˜

---

## ğŸ‰ è¨­ç½®å®Œæˆï¼

æ­å–œï¼ä½ çš„æœ¬åœ° PostgreSQL é–‹ç™¼ç’°å¢ƒå·²ç¶“å®Œå…¨è¨­ç½®å¥½äº†ï¼

---

## âœ… å·²å®Œæˆçš„æ­¥é©Ÿ

### 1. Docker Desktop å®‰è£ âœ…
- **èŠ¯ç‰‡é¡å‹**: Intel (x86_64)
- **Docker ç‰ˆæœ¬**: 28.5.1
- **Docker Compose ç‰ˆæœ¬**: v2.40.0-desktop.1
- **ç‹€æ…‹**: æ­£åœ¨é‹è¡Œ

### 2. PostgreSQL å®¹å™¨å•Ÿå‹• âœ…
- **å®¹å™¨å**: tattoo-crm-postgres
- **é¡åƒ**: postgres:15-alpine
- **ç«¯å£**: 5432:5432
- **ç‹€æ…‹**: å¥åº·é‹è¡Œä¸­

### 3. æ•¸æ“šåº«åˆå§‹åŒ– âœ…
- **æ•¸æ“šåº«å**: tattoo_crm_dev
- **ç”¨æˆ¶**: tattoo_user
- **Schema**: å·²åŒæ­¥
- **é·ç§»**: ä½¿ç”¨ db pushï¼ˆé–‹ç™¼ç’°å¢ƒï¼‰

### 4. ç¨®å­æ•¸æ“šè¼‰å…¥ âœ…
- **åˆ†åº—**: 2 å€‹ï¼ˆä¸‰é‡åº—ã€æ±æ¸¯åº—ï¼‰
- **ç”¨æˆ¶**: 18 ä½ï¼ˆ1 BOSS + 2 ç¶“ç† + 12 æœƒå“¡ + 3 åˆºé’å¸«ï¼‰
- **æœå‹™**: 19 å€‹
- **é ç´„**: 24 å€‹
- **è¨‚å–®**: 15 å€‹

### 5. å¾Œç«¯æœå‹™å•Ÿå‹• âœ…
- **ç«¯å£**: 4000
- **ç‹€æ…‹**: æ­£åœ¨é‹è¡Œ
- **æ•¸æ“šåº«é€£æ¥**: PostgreSQL âœ…
- **API æ¸¬è©¦**: é€šé âœ…

---

## ğŸ“Š ç•¶å‰é…ç½®

### ç’°å¢ƒè®Šé‡
```env
DATABASE_URL="postgresql://tattoo_user:tattoo_password@localhost:5432/tattoo_crm_dev"
PORT=4000
NODE_ENV=development
```

### æ•¸æ“šåº«é€£æ¥ä¿¡æ¯
| é …ç›® | å€¼ |
|------|-----|
| ä¸»æ©Ÿ | localhost |
| ç«¯å£ | 5432 |
| æ•¸æ“šåº« | tattoo_crm_dev |
| ç”¨æˆ¶ | tattoo_user |
| å¯†ç¢¼ | tattoo_password |

### å®¹å™¨ä¿¡æ¯
```bash
CONTAINER ID   IMAGE               STATUS         PORTS
tattoo-crm-postgres   postgres:15-alpine   Up 5 minutes   0.0.0.0:5432->5432/tcp
```

---

## ğŸ—„ï¸ æ•¸æ“šé©—è­‰çµæœ

### åˆ†åº—æ•¸æ“š âœ…

#### ä¸‰é‡åº—
- **ID**: cmgru71k80001sbbj7k14ovg6
- **åœ°å€**: æ–°åŒ—å¸‚ä¸‰é‡å€é‡æ–°è·¯ä¸€æ®µ123è™Ÿ
- **é›»è©±**: 02-2975-1234
- **ç”¨æˆ¶æ•¸**: 9
- **åˆºé’å¸«**: 2ï¼ˆé»ƒæ™¨æ´‹ã€æ—æ‰¿è‘‰ï¼‰
- **é ç´„æ•¸**: 16
- **è¨‚å–®æ•¸**: 10

#### æ±æ¸¯åº—
- **ID**: cmgru71ka0002sbbj6hk19es2
- **åœ°å€**: å±æ±ç¸£æ±æ¸¯é®æ²¿æµ·è·¯356è™Ÿ, 928
- **é›»è©±**: 08 831 1615
- **ç”¨æˆ¶æ•¸**: 8
- **åˆºé’å¸«**: 1ï¼ˆé™³éœ‡å®‡ï¼‰
- **é ç´„æ•¸**: 8
- **è¨‚å–®æ•¸**: 5

### æ¸¬è©¦å¸³è™Ÿ âœ…

| è§’è‰² | Email | å¯†ç¢¼ | åˆ†åº— |
|------|-------|------|------|
| BOSS | admin@test.com | 12345678 | - |
| ä¸‰é‡åº—ç¶“ç† | manager1@test.com | 12345678 | ä¸‰é‡åº— |
| æ±æ¸¯åº—ç¶“ç† | manager2@test.com | 12345678 | æ±æ¸¯åº— |
| åˆºé’å¸« | artist1@test.com ~ artist3@test.com | 12345678 | å„åˆ†åº— |
| æœƒå“¡ | member1@test.com ~ member12@test.com | 12345678 | å„åˆ†åº— |

---

## ğŸ”§ API æ¸¬è©¦çµæœ

### æ¸¬è©¦ 1: å¾Œç«¯å¥åº·æª¢æŸ¥ âœ…
```bash
curl http://localhost:4000
# è¼¸å‡º: Hello World!
```

### æ¸¬è©¦ 2: ç™»å…¥åŠŸèƒ½ âœ…
```bash
curl -X POST http://localhost:4000/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email": "admin@test.com", "password": "12345678"}'
# è¼¸å‡º: { "accessToken": "...", "refreshToken": "..." }
```

### æ¸¬è©¦ 3: åˆ†åº— API âœ…
```bash
curl http://localhost:4000/branches \
  -H "Authorization: Bearer <token>"
# è¼¸å‡º:
# - ä¸‰é‡åº— (cmgru71k80001sbbj7k14ovg6)
# - æ±æ¸¯åº— (cmgru71ka0002sbbj6hk19es2)
```

---

## ğŸ’» æ—¥å¸¸ä½¿ç”¨æŒ‡å—

### å•Ÿå‹•é–‹ç™¼ç’°å¢ƒ

```bash
# 1. ç¢ºä¿ Docker Desktop æ­£åœ¨é‹è¡Œï¼ˆæŸ¥çœ‹å³ä¸Šè§’åœ–æ¨™ï¼‰

# 2. å•Ÿå‹• PostgreSQLï¼ˆå¦‚æœæ²’æœ‰é‹è¡Œï¼‰
cd /Users/jerrylin/tattoo-crm/backend
docker-compose up -d

# 3. å•Ÿå‹•å¾Œç«¯æœå‹™
npm run start:dev
```

### åœæ­¢æœå‹™

```bash
# åœæ­¢å¾Œç«¯æœå‹™ï¼šæŒ‰ Ctrl+C

# åœæ­¢ PostgreSQLï¼ˆå¯é¸ï¼‰
docker-compose stop
```

### å¸¸ç”¨å‘½ä»¤

```bash
# æŸ¥çœ‹ PostgreSQL ç‹€æ…‹
docker-compose ps

# æŸ¥çœ‹æ—¥èªŒ
docker-compose logs -f postgres

# é‡å•Ÿ PostgreSQL
docker-compose restart

# é€£æ¥åˆ°æ•¸æ“šåº«
docker-compose exec postgres psql -U tattoo_user -d tattoo_crm_dev

# ä½¿ç”¨ Prisma Studio æŸ¥çœ‹æ•¸æ“š
npx prisma studio

# é‡ç½®æ•¸æ“šåº«
./scripts/reseed.sh

# é©—è­‰æ•¸æ“š
npx ts-node scripts/verify-data.ts
```

---

## ğŸ“‚ å‚™ä»½æ–‡ä»¶

### å·²å‰µå»ºçš„å‚™ä»½
- `.env.sqlite.backup` - åŸå§‹ SQLite é…ç½®å‚™ä»½

### æ¢å¾©åˆ° SQLiteï¼ˆä¸æ¨è–¦ï¼‰
```bash
cp .env.sqlite.backup .env
docker-compose down
```

---

## ğŸ¯ ç’°å¢ƒå°æ¯”

### ä¹‹å‰ï¼ˆSQLiteï¼‰
```
âŒ æ•¸æ“šåº«: SQLite
âŒ æ–‡ä»¶ä½ç½®: ./prisma/dev.db
âŒ èˆ‡ç”Ÿç”¢ç’°å¢ƒä¸ä¸€è‡´
âŒ åŠŸèƒ½å—é™
```

### ç¾åœ¨ï¼ˆPostgreSQLï¼‰
```
âœ… æ•¸æ“šåº«: PostgreSQL
âœ… å®¹å™¨åŒ–éƒ¨ç½²
âœ… èˆ‡ç”Ÿç”¢ç’°å¢ƒå®Œå…¨ä¸€è‡´
âœ… åŠŸèƒ½å®Œæ•´
âœ… æ”¯æŒä¸¦ç™¼
```

---

## ğŸš€ ä¸‹ä¸€æ­¥

### ç«‹å³å¯ä»¥åšçš„äº‹

1. **å•Ÿå‹•å‰ç«¯æœå‹™**
   ```bash
   cd /Users/jerrylin/tattoo-crm/frontend
   npm run dev
   ```

2. **æŸ¥çœ‹æ•¸æ“šåº«**
   ```bash
   cd /Users/jerrylin/tattoo-crm/backend
   npx prisma studio
   ```
   ç„¶å¾Œè¨ªå• http://localhost:5555

3. **æ¸¬è©¦å®Œæ•´æµç¨‹**
   - è¨ªå•å‰ç«¯ï¼šhttp://localhost:3000
   - ä½¿ç”¨æ¸¬è©¦å¸³è™Ÿç™»å…¥
   - æ¸¬è©¦åˆ†åº—ç¯©é¸åŠŸèƒ½
   - ç¢ºèªæ‰€æœ‰åŠŸèƒ½æ­£å¸¸

### å¾ŒçºŒå„ªåŒ–

- [ ] è¨­ç½® Docker Desktop é–‹æ©Ÿè‡ªå‹•å•Ÿå‹•
- [ ] å®šæœŸå‚™ä»½é‡è¦æ•¸æ“š
- [ ] ç†Ÿæ‚‰å¸¸ç”¨å‘½ä»¤
- [ ] é–±è®€å®Œæ•´æ–‡æª”

---

## ğŸ“š ç›¸é—œæ–‡æª”

| æ–‡æª” | ç”¨é€” |
|------|------|
| `QUICK_START_POSTGRESQL.md` | å¿«é€Ÿé–‹å§‹æŒ‡å— |
| `LOCAL_POSTGRESQL_SETUP.md` | å®Œæ•´è¨­ç½®æ–‡æª” |
| `DATABASE_RESET_GUIDE.md` | æ•¸æ“šåº«ç®¡ç† |
| `CRITICAL_FIX_PRODUCTION_DATABASE.md` | ç”Ÿç”¢ç’°å¢ƒèªªæ˜ |

---

## âœ¨ æˆåŠŸæŒ‡æ¨™

- âœ… Docker Desktop å·²å®‰è£ä¸¦é‹è¡Œ
- âœ… PostgreSQL å®¹å™¨å¥åº·é‹è¡Œ
- âœ… æ•¸æ“šåº«å·²åˆå§‹åŒ–ä¸¦è¼‰å…¥æ•¸æ“š
- âœ… å¾Œç«¯æœå‹™æˆåŠŸé€£æ¥ PostgreSQL
- âœ… API æ¸¬è©¦å…¨éƒ¨é€šé
- âœ… åˆ†åº—æ•¸æ“šæ­£ç¢ºï¼ˆ2å€‹åˆ†åº—ï¼‰
- âœ… èˆ‡ç”Ÿç”¢ç’°å¢ƒé…ç½®ä¸€è‡´

---

## ğŸŠ ç¸½çµ

**æ­å–œï¼** ğŸ‰

ä½ å·²ç¶“æˆåŠŸå®Œæˆäº†æœ¬åœ° PostgreSQL é–‹ç™¼ç’°å¢ƒçš„è¨­ç½®ï¼

**é—œéµæˆå°±**ï¼š
- âœ… ç’°å¢ƒä¸€è‡´æ€§ï¼šæœ¬åœ° = ç”Ÿç”¢
- âœ… é…ç½®ç°¡åŒ–ï¼šä¸€å€‹ schema.prisma
- âœ… åŠŸèƒ½å®Œæ•´ï¼šPostgreSQL å…¨åŠŸèƒ½
- âœ… é–‹ç™¼å°±ç·’ï¼šç«‹å³å¯ä»¥é–‹å§‹é–‹ç™¼

**å¾ç¾åœ¨é–‹å§‹**ï¼š
- æœ¬åœ°é–‹ç™¼ä½¿ç”¨ PostgreSQL
- ä¸æœƒå†æœ‰ SQLite vs PostgreSQL çš„å•é¡Œ
- æ¸¬è©¦çµæœæ›´å¯é 
- éƒ¨ç½²æ›´é †æš¢

---

**è¨­ç½®å®Œæˆæ™‚é–“**: 2025-10-15 18:18  
**ç‹€æ…‹**: âœ… å®Œå…¨æˆåŠŸ  
**æº–å‚™å°±ç·’**: ğŸš€ å¯ä»¥é–‹å§‹é–‹ç™¼äº†ï¼

---

## ğŸ†˜ å¦‚æœé‡åˆ°å•é¡Œ

1. **æŸ¥çœ‹æ–‡æª”**: `LOCAL_POSTGRESQL_SETUP.md`
2. **æŸ¥çœ‹æ—¥èªŒ**: `docker-compose logs postgres`
3. **é‡å•Ÿæœå‹™**: `docker-compose restart`
4. **å®Œå…¨é‡ç½®**: `docker-compose down -v && ./scripts/setup-local-postgres.sh`

**ç¥é–‹ç™¼é †åˆ©ï¼** ğŸš€

