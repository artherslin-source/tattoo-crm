# 🚀 Railway 部署完整測試數據指南

**日期：** 2025-01-16  
**狀態：** ✅ 代碼已推送，等待 Railway 部署

---

## 📊 當前狀態

### **✅ 已完成**
- ✅ 本地環境完整配置
- ✅ 本地資料庫有完整測試數據
- ✅ 代碼已推送到 GitHub
- ✅ Railway 自動部署已觸發

### **⏳ 進行中**
- ⏳ Railway 正在部署（2-3 分鐘）
- ⏳ 需要設定環境變數觸發數據重建

---

## 🎯 部署目標

將本地完整的測試數據部署到 Railway，供客戶測試：

| 數據類型 | 數量 | 說明 |
|----------|------|------|
| **分店** | 2 個 | 三重店、東港店 |
| **刺青師** | 3 個 | 陳震宇、黃晨洋、林承葉 |
| **會員** | 12 個 | 包含儲值餘額 |
| **服務項目** | 19 個 | 各種刺青服務 |
| **預約** | 24 個 | 分配到刺青師 |
| **訂單** | 15 個 | 一次付清和分期 |

---

## 🔧 步驟 1：等待 Railway 部署完成

### **檢查部署狀態**
1. 訪問：https://railway.app/dashboard
2. 找到 `tattoo-crm-backend` 服務
3. 查看 **Deployments** 標籤
4. 等待最新部署顯示 **✅ Deployed**

**預估時間：** 2-3 分鐘

---

## 🔧 步驟 2：設定環境變數

### **在 Railway Dashboard 中設定**

1. **進入後端服務**
   - 點擊 `tattoo-crm-backend` 服務

2. **切換到 Variables 標籤**
   - 點擊 **Variables** 標籤

3. **添加環境變數**
   點擊 **New Variable** 並添加：

   ```
   Name: RUN_SEED
   Value: true
   ```

   ```
   Name: PROTECT_REAL_DATA
   Value: false
   ```

4. **保存設定**
   - 點擊 **Save** 或 **Add**

### **環境變數說明**

| 變數名 | 值 | 作用 |
|--------|-----|------|
| `RUN_SEED` | `true` | 觸發數據重建 |
| `PROTECT_REAL_DATA` | `false` | 允許重建所有數據 |

---

## 🔧 步驟 3：觸發重新部署

### **自動觸發**
- 設定環境變數後，Railway 會自動重新部署
- 等待部署完成（2-3 分鐘）

### **手動觸發（如需要）**
1. 在 **Deployments** 標籤
2. 點擊 **Redeploy** 按鈕

---

## 🔧 步驟 4：驗證部署結果

### **檢查部署日誌**
1. 在 **Deployments** 標籤
2. 點擊最新的部署
3. 查看 **Build Logs** 和 **Deploy Logs**
4. 確認看到以下訊息：

```
🌱 開始執行 Prisma seeding...
⚠️ 完整重建模式：將重建所有數據（包括分店和刺青師）
✅ 建立管理員帳號: admin@test.com
✅ 建立 2 個分店（三重店、東港店）
✅ 建立 3 個刺青師
✅ 建立 12 個會員帳號
✅ 建立 19 個服務
✅ 建立 24 個預約
✅ 建立 15 個訂單
🎉 Seeding 完成！
```

---

## 🧪 步驟 5：測試前端數據

### **訪問前端**
```
URL: https://tattoo-crm-production.up.railway.app
```

### **登入測試**
```
Email: admin@test.com
Password: 12345678
```

### **檢查各頁面數據**

| 頁面 | 預期數據量 | 測試項目 |
|------|------------|----------|
| **管理服務項目** | 19 個 | 查看服務列表 |
| **管理刺青師** | 3 個 | 查看刺青師列表 |
| **管理預約** | 24 個 | 查看預約列表 |
| **管理訂單** | 15 個 | 查看訂單列表 |
| **管理會員** | 12 個 | 查看會員列表，測試儲值/消費 |

---

## 🎯 測試帳號

### **管理員帳號**
```
Email: admin@test.com
Password: 12345678
角色: BOSS（可查看所有數據）
```

### **分店經理帳號**
```
三重店經理:
Email: manager1@test.com
Password: 12345678

東港店經理:
Email: manager2@test.com
Password: 12345678
```

### **會員帳號**
```
Email: member1@test.com ~ member12@test.com
Password: 12345678
```

---

## 🚨 故障排除

### **問題 1：部署失敗**

**症狀：** Railway 部署顯示失敗

**解決方案：**
1. 查看 **Build Logs** 錯誤訊息
2. 檢查環境變數是否正確設定
3. 重新部署

### **問題 2：前端沒有數據**

**症狀：** 前端頁面顯示 0 個數據

**可能原因：**
1. 環境變數未設定
2. Seeding 失敗
3. 前端連接到錯誤的後端

**解決方案：**
1. 確認 `RUN_SEED=true` 已設定
2. 查看部署日誌確認 seeding 成功
3. 檢查前端 API 連接

### **問題 3：Seeding 失敗**

**症狀：** 部署日誌顯示 seeding 錯誤

**常見錯誤：**
- 資料庫連接失敗
- 權限不足
- 唯一約束衝突

**解決方案：**
1. 檢查 `DATABASE_URL` 是否正確
2. 確認資料庫權限
3. 使用 `PROTECT_REAL_DATA=true` 重試

---

## 📋 部署檢查清單

### **部署前**
- [ ] 本地環境正常運行
- [ ] 本地數據完整
- [ ] 代碼已提交到 GitHub

### **部署中**
- [ ] Railway 部署成功
- [ ] 環境變數已設定
- [ ] 重新部署完成

### **部署後**
- [ ] 前端可以訪問
- [ ] 登入功能正常
- [ ] 各頁面顯示正確數據
- [ ] 儲值/消費功能正常

---

## 🎉 成功指標

### **部署成功標誌**
1. ✅ Railway 部署狀態：Deployed
2. ✅ 部署日誌顯示：Seeding 完成
3. ✅ 前端顯示完整數據
4. ✅ 所有功能正常運作

### **數據驗證**
- 管理服務項目：19 個 ✅
- 管理刺青師：3 個 ✅
- 管理預約：24 個 ✅
- 管理訂單：15 個 ✅
- 管理會員：12 個 ✅

---

## 📞 支援

### **如果遇到問題**
1. 查看 Railway 部署日誌
2. 檢查環境變數設定
3. 確認前端 API 連接
4. 提供具體錯誤訊息

### **Railway 資源**
- Dashboard: https://railway.app/dashboard
- 文檔: https://docs.railway.app
- 支援: https://railway.app/support

---

## 🚀 下一步

部署完成後：

1. **客戶測試**
   - 提供測試帳號給客戶
   - 指導客戶測試各功能

2. **監控**
   - 監控 Railway 服務狀態
   - 查看使用統計

3. **維護**
   - 定期備份數據
   - 更新服務版本

---

**部署完成後，Railway 將擁有與本地環境完全一致的測試數據！** 🎉

**Git Commit:** `07f01ca` - "feat: Deploy with complete test data to Railway"
