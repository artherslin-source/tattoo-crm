# Railway 生產環境數據保護設置指南

## 🎯 目標

在 Railway 生產環境中設置 `PROTECT_REAL_DATA=true`，確保重建數據時保留真實的分店和刺青師。

---

## 📋 設置步驟

### 步驟 1：登入 Railway

1. 訪問：https://railway.app/
2. 使用您的帳號登入

### 步驟 2：進入專案

1. 在 Dashboard 中找到您的專案：**tattoo-crm**
2. 點擊進入

### 步驟 3：選擇 Backend 服務

1. 在專案頁面中，點擊 **backend** 服務（不是 frontend）
2. 確認您在正確的服務中

### 步驟 4：添加環境變數

1. 在 backend 服務頁面，點擊頂部的 **Variables** 標籤
2. 找到 **New Variable** 按鈕並點擊
3. 添加新變數：
   ```
   Variable Name: PROTECT_REAL_DATA
   Variable Value: true
   ```
4. 點擊 **Add** 按鈕
5. 等待幾秒鐘，確認變數已添加

### 步驟 5：驗證設置

檢查環境變數列表，確認看到：
- `PROTECT_REAL_DATA` = `true`

---

## ✅ 完成！

現在您的生產環境已經設置好數據保護模式。

### 下次重建數據時：

```bash
# 在 Railway Shell 中執行（如果可用）
npm run seed

# 或使用 Railway CLI
railway run npm run seed
```

種子腳本會：
- ✅ 保留現有的分店（三重店、東港店）
- ✅ 保留現有的刺青師（陳震宇、黃晨洋、林承葉）
- 🔄 重建測試數據（管理員、會員、預約、訂單等）

---

## 🔍 驗證環境變數

### 方法 1：查看 Railway Variables 頁面

1. 進入 backend 服務
2. 點擊 **Variables** 標籤
3. 確認 `PROTECT_REAL_DATA` 存在且值為 `true`

### 方法 2：查看部署日誌

下次部署後，查看 Deploy Logs：
```
🌱 開始執行 Prisma seeding...
🛡️ 保護模式：將保留現有的分店和刺青師數據
```

如果看到這個訊息，說明保護模式已啟用。

---

## 📸 截圖參考

### Variables 頁面應該看起來像這樣：

```
┌─────────────────────────────────────────┐
│ Variables                                │
├─────────────────────────────────────────┤
│ DATABASE_URL         postgresql://...   │
│ JWT_SECRET           ******************   │
│ NODE_ENV             production          │
│ PORT                 ${{PORT}}           │
│ CORS_ORIGIN          https://...        │
│ PROTECT_REAL_DATA    true               │ ← 新增
└─────────────────────────────────────────┘
```

---

## 🚨 重要提醒

1. **這不是備份機制**
   - 保護模式只是在重建時跳過某些表
   - 重要數據請定期備份

2. **測試數據會被刪除**
   - 保護模式會刪除並重建所有會員、預約、訂單
   - 只保留分店和刺青師

3. **管理員帳號會重置**
   - 即使在保護模式下，管理員帳號也會重新創建
   - 預設密碼：`12345678`

---

## 🔄 後續操作（可選）

如果您想在生產環境中測試保護模式：

### 步驟 1：檢查當前數據

```bash
# 登入管理後台
https://tattoo-crm-production.up.railway.app

# 記錄當前分店和刺青師數量
- 分店：應該有 2 個（三重店、東港店）
- 刺青師：應該有 3 個（陳震宇、黃晨洋、林承葉）
```

### 步驟 2：執行種子腳本（謹慎！）

```bash
# 使用 Railway Shell（如果可用）
npm run seed
```

### 步驟 3：驗證結果

```bash
# 再次登入管理後台
# 確認：
✅ 分店數量保持為 2 個
✅ 刺青師數量保持為 3 個
✅ 會員、預約、訂單已重建為測試數據
```

---

## 📞 需要幫助？

如果遇到問題，請檢查：

1. **環境變數是否正確設置？**
   - 名稱：`PROTECT_REAL_DATA`（注意大小寫）
   - 值：`true`（小寫）

2. **是否重新部署？**
   - 添加環境變數後，Railway 通常會自動重新部署
   - 如果沒有，手動觸發一次部署

3. **查看部署日誌**
   - 在 Railway 中查看最新的 Deploy Logs
   - 搜尋 "保護模式" 或 "PROTECT_REAL_DATA"

---

最後更新：2025-10-15

